-- SQL SESSION-3, 14.01.2023, Data Types & Built-in Functions

-- String Data Types
-- varchar vs. nvarchar (unicode / non-unicode) -- unicode karakterler iÃ§in nchar-nvarchar kullanÄ±lÄ±r. non_unicode ise varchar yada char kullanÄ±lÄ±r. 

SELECT N'Ù‚Ù…Ø±'

SELECT CONVERT(VARCHAR, N'Ù‚Ù…Ø±')
SELECT CONVERT(NVARCHAR, N'Ù‚Ù…Ø±')

SELECT N'ðŸ˜€'


-- char vs. varchar -- char(5) belirledik ancak 3 karakter yazdÄ±k yine de char 5 byte harcar. varchar(5) belirledik 3 karakter yazdÄ±k 3 byte harcar. 

SELECT DATALENGTH(CONVERT(CHAR(50), 'clarusway')) -- boyutunu verir.
SELECT DATALENGTH(CONVERT(VARCHAR(50), 'clarusway')) -- clarusway 9 karakter olduÄŸu iÃ§in 9 byte dÃ¶ndÃ¼rÃ¼r. 

-- EÄŸer sÄ±nÄ±rlama yapmazsanÄ±z VARCHAR Ä±n 65000 karakter sÄ±nÄ±rÄ± var. CHAR kullanÄ±rsanÄ±z 255 karaktere kadar mÃ¼saade eder. VARCHAR'Ä± daha bÃ¼yÃ¼k dokÃ¼man yazacaksanÄ±z tercih edebilirsiniz.
-- AralarÄ±ndaki fark ÅŸu: Diyelim siz CHAR dediniz ve karakter uzunluÄŸunu 200 olarak belirlediniz. Ondan sonra siz bir satÄ±ra ister 5 karakter girin ister 200 karakter girin CHAR her zaman hafÄ±zada 200 karakter yer tutar.
-- Ama diyelim ki VARCHAR'a 200 deÄŸeri girdiniz. Bir satÄ±ra 10 karakter yazdÄ±nÄ±z. VARCHAR hafÄ±zada girdiÄŸiniz karakter kadar yer kaplar. 200 karakter yer kaplamaz.



-------------------------------------------------------------------------
--DATE FUNCTIONS---------------
-------------------------------------------------------------------------

----//////////////////////////////////////////////
---Data Types and getdate() function

SELECT GETDATE() --log kayÄ±tlarÄ±nÄ±n tutulmasÄ±nda Ã§ok kullanÄ±lÄ±yor. sistem tarihini dÃ¶ndÃ¼rÃ¼r.
-- 2023-01-29 17:02:10.190

CREATE TABLE t_date_time (
	A_time [time],
	A_date [date],
	A_smalldatetime [smalldatetime], -- 1900 yÄ±lÄ±na kadar girilir. 
	A_datetime [datetime], -- 1753 yÄ±lÄ±na kadar. 
	A_datetime2 [datetime2],
	A_datetimeoffset [datetimeoffset]
);

SELECT * FROM t_date_time

INSERT t_date_time 
VALUES (GETDATE(),GETDATE(),GETDATE(),GETDATE(),GETDATE(),GETDATE())


----//////////////////////////////////////////////
---Functions for return date or time parts

SELECT	A_date,
		DATENAME(DW, A_date) [weekday],             
		DATEPART(DW, A_date) [weekday_2],           
		DATENAME(M, A_date) [month],       --nvarchar dÃ¶ndÃ¼rÃ¼r.       
		DATEPART(month, A_date) [month_2], -- int dÃ¶ndÃ¼rÃ¼r. 
		DAY(A_date) [day],
		MONTH(A_date) [month_3],
		YEAR(A_date) [year],
		A_time,
		DATEPART (minute, A_time) [minute],
		DATEPART (NANOSECOND, A_time) [nanosecond]
FROM	t_date_time;

/*  YEAR / YYYY / YY
	QUARTER / QQ / Q 
	MONTH / MM / M
	DAYOFYEAR / DY / Y
	WEEK / WW / WK
	WEEKDAY / DW
	DAY / DD / D
	HOUR / HH
	MINUTE / MI / N
	SECOND / SS / S
	MILLISECOND / MS
	MICROSECOND / MCS
	NANOSECOND / NS  */


----//////////////////////////////////////////////
---Functions for return date or time differences

SELECT A_date,        
        A_datetime,
        GETDATE() AS [CurrentTime],
        DATEDIFF (DAY, '2020-11-30', A_date) Diff_day,
        DATEDIFF (MONTH, '2020-11-30', A_date) Diff_month,
        DATEDIFF (YEAR, '2020-11-30', A_date) Diff_year,
        DATEDIFF (HOUR, A_datetime, GETDATE()) Diff_Hour,
        DATEDIFF (MINUTE, A_datetime, GETDATE()) Diff_Min
FROM   t_date_time;


SELECT * FROM sale.orders

select	order_date, shipped_date,
		DATEDIFF(DAY, order_date, shipped_date) day_diff, 
		DATEDIFF(DAY, shipped_date, order_date) day_diff
from	sale.orders
where	order_id = 1;


----//////////////////////////////////////////////
---Functions for Modify date and time

SELECT	order_date,
		DATEADD(YEAR, 5, order_date), 
		DATEADD(DAY, 5, order_date),
		DATEADD(DAY, -5, order_date)		
FROM	sale.orders
where	order_id = 1

SELECT GETDATE(), DATEADD(HOUR, 5, GETDATE())

SELECT	order_date, EOMONTH(order_date) end_of_month, -- eomonth belirtilen tarihin sonuna gider.
		EOMONTH(order_date, 2) eomonth_next_two_months -- 2 ay sonrasÄ±nÄ±n ay sonuna gider.
FROM	sale.orders
where	order_id = 1;


----//////////////////////////////////////////////
---Function for Validate date and time

SELECT ISDATE('123')  -- date mi deÄŸil mi?

SELECT ISDATE('20230114') --SQL server veri tipini kendisi Ã§evirir. tarih formatÄ±na Ã§evirebilirim derse SQL server onu tarih formatÄ±nda okuyor. 

--SELECT 1 + '1' -- SQL server dolaylÄ± Ã§evirme yÃ¶ntemi ile '1' string olarak deÄŸilde yorumlayarak int olarak alÄ±yor. ve toplama iÅŸlemini yapÄ±yor. 

SELECT ISDATE('2021-12-02')  --2021/12/02  ||| 2021.12.02  |||  20211202

SELECT ISDATE('02/12/2022')  --02-12-2022  |||  02.12.2022

SELECT ISDATE('02122022') --ERROR


----//////////////////////////////////////////////
---QUERY TIME

--Write a query returns orders that are shipped more than two days after the order date. 
--2 gÃ¼nden geÃ§ kargolanan sipariÅŸlerin bilgilerini getiriniz.

SELECT order_date, shipped_date, DATEDIFF(DAY, order_date, shipped_date) date_diff
FROM sale.orders
WHERE DATEDIFF(DAY, order_date, shipped_date) > 2
ORDER BY date_diff DESC

-------------------------------------------------------------------------
--STRING FUNCTIONS---------------
-------------------------------------------------------------------------

-----LEN

SELECT LEN('welcome') -- baÅŸtaki boÅŸluÄŸu sayar. sonraki boÅŸluÄŸu saymaz. 

SELECT LEN(' welcome')

SELECT LEN(' welcome ')

SELECT LEN(123456789)


--If there is a quote in the string

SELECT 'Jack''s Phone' -- escape karakteri


-----CHARINDEX
-- CHARINDEX()iÅŸlev, baÄŸÄ±msÄ±z deÄŸiÅŸken olarak bir dize ve bunun bir alt dizesini alÄ±r 
-- ve alt dizenin ilk karakteri olan alt dizenin konumunu gÃ¶steren bir tamsayÄ± dÃ¶ndÃ¼rÃ¼r. 
-- CHARINDEX()iÅŸlev, alt dizenin ilk oluÅŸumunu bulur ve tamsayÄ± tÃ¼rÃ¼nde bir deÄŸer dÃ¶ndÃ¼rÃ¼r.
-- CHARINDEX()iÅŸlevi bÃ¼yÃ¼k/kÃ¼Ã§Ã¼k harfe duyarlÄ± olarak Ã§alÄ±ÅŸÄ±r. 
SELECT CHARINDEX('C', 'CHARACTER') -- karakter ararÄ±z. 

SELECT CHARINDEX('C', 'CHARACTER', 2)

SELECT CHARINDEX('CT', 'CHARACTER') 

SELECT CHARINDEX('ct', 'CHARACTER')


--PATINDEX()

-- PATINDEX(), belirtilen bir ifadede bir kalÄ±bÄ±n ilk oluÅŸumunun baÅŸlangÄ±Ã§ â€‹â€‹konumunu 
-- veya kalÄ±p bulunamazsa tÃ¼m geÃ§erli metin ve karakter veri tÃ¼rlerinde sÄ±fÄ±rlarÄ± dÃ¶ndÃ¼rÃ¼r.
-- Desen veya ifadeden biri ise NULL, PATINDEX()NULL dÃ¶ndÃ¼rÃ¼r.
-- PATINDEX() BaÅŸlangÄ±Ã§ â€‹â€‹pozisyonu 1'dir.
-- PATINDEX aynÄ± LIKE ÅŸekilde Ã§alÄ±ÅŸÄ±r , bÃ¶ylece herhangi bir joker karakter kullanabilirsiniz. 
-- Deseni  % (yÃ¼zde) ler arasÄ±na almak zorunda deÄŸilsiniz. 
-- PATINDEX(), LIKE'dan farklÄ± olarak, CHARINDEX()'in yaptÄ±ÄŸÄ±na benzer bir konum dÃ¶ndÃ¼rÃ¼r.

SELECT PATINDEX ('%R','CHARACTER');  -- Sondaki R den onceki karakterleri al

SELECT PATINDEX ('R%','CHARACTER');   -- R den sonraki karakterleri getir

SELECT PATINDEX ('___R%','CHARACTER');  
SELECT PATINDEX('%R', 'CHARACTER') -- pattern ararÄ±z.

SELECT PATINDEX('R%', 'CHARACTER')

SELECT PATINDEX('%[RC]%', 'CHARACTER') -- [RC] sadece R veya C harfi olsun. baÅŸÄ± sonu farklÄ± olabilir. C harfi ilk sÄ±rada olduÄŸu iÃ§in 1 dÃ¶ndÃ¼rÃ¼r. 

SELECT PATINDEX('_H%' , 'CHARACTER')


--LEFT

SELECT LEFT('CHARACTER', 5) -- 5. karakteri dÃ¶ndÃ¼rÃ¼r. 

SELECT LEFT(' CHARACTER', 5)


--RIGHT

SELECT RIGHT('CHARACTER', 5)

SELECT RIGHT('CHARACTER ', 5)
SELECT RIGHT(12345, 5)


--SUBSTRING

SELECT SUBSTRING('CHARACTER', 3, 5)

SELECT SUBSTRING('CHARACTER', 0, 5) -- SQL server indeks pythondan farklÄ±... 0 dediÄŸi iÃ§in 4 karakter aldÄ±. 

SELECT SUBSTRING('CHARACTER', -1, 5)

SELECT SUBSTRING(88888888, 3, 3) --error  numaeric deÄŸerlerle kullanÄ±lmaz. 


--LOWER

SELECT LOWER('CHARACTER')


--UPPER

SELECT UPPER('character')


--How to grow the first character of the 'character' word.
SELECT UPPER(LEFT('character',1))
SELECT LOWER(RIGHT('character', LEN('character')-1))

SELECT UPPER(LEFT('character',1)) + LOWER(RIGHT('character', LEN('character')-1))


------------------------------------------
---TRIM, LTRIM, RTRIM

SELECT TRIM('  CHARACTER   ')

SELECT TRIM('  CHARA CTER   ')

SELECT TRIM('?, ' FROM '    ?SQL Server,    ') AS TrimmedString;  -- karakterleri (boÅŸluk dahil) belirt '?, ' ÅŸeklinde belirttik ve onlarÄ± aldÄ±. 

SELECT LTRIM('  CHARACTER   ')

SELECT RTRIM('  CHARACTER   ')
-- Trim yapmak istediÄŸimiz birden fazla karakter var ise bunlarÄ± aÅŸaÄŸÄ±daki gibi belirtebiliriz.
-- GirdiÄŸimiz ifadenin iÃ§indeki herhangi bir karakterle karÅŸÄ±laÅŸtÄ±ÄŸÄ±nda bu karakter silinecektir. Ta ki bu karakterler dÄ±ÅŸÄ±nda baÅŸka bir karakterle kaÅŸÄ±laÅŸana kadar.
SELECT TRIM('ABC' FROM 'CCCCBBBAAAFRHGKDFKSLDFJKSDFACBBCACABACABCA')

---REPLACE

SELECT REPLACE('CHARACTER STRING', ' ', '/')

SELECT REPLACE(123456, 2, 0)


---CONCAT

SELECT first_name + ' ' + last_name
FROM sale.customer

SELECT CONCAT(first_name,' ',last_name)
FROM sale.customer


-------------------------------------------------------------------------
--OTHER FUNCTIONS---------------
-------------------------------------------------------------------------

---CAST

SELECT 1 + '1' --SQL server '1' i int olarak algÄ±layÄ±p int dÃ¶nÃ¼ÅŸtÃ¼rÃ¼yor.
SELECT 1 + 'GG' --SQL server 'GG' yi integere Ã§eviremediÄŸinden hata veriyor.

SELECT CAST(12345 AS CHAR)

SELECT CAST(123.95 AS INT)

SELECT CAST(123.95 AS DEC(3,0)) --DECIMAL(3,0) -- sadece 3 karakter olsun ve kesirli birÅŸey istemiyorum.


---CONVERT

SELECT CONVERT(int, 30.60)

SELECT CONVERT(VARCHAR(10), '2020-10-10')
SELECT CONVERT(DATETIME, '2020-10-10')

SELECT CAST(12 AS DECIMAL(5,2) ) AS decimal_value;
-- integer bir veriyi 5 rakamdan oluÅŸan ve bunun virgÃ¼lden sonrasÄ± 2 rakam olan decimal'e Ã§evirdi.

---SQL Server Datetime Formatting
---Converting a Datetime to a Varchar

SELECT CONVERT(VARCHAR, GETDATE(), 7) 
SELECT CONVERT(NVARCHAR, GETDATE(), 100) --0 / 100
SELECT CONVERT(NVARCHAR, GETDATE(), 112)
SELECT CONVERT(NVARCHAR, GETDATE(), 113) --13 / 113

SELECT CAST('20201010' AS DATE)
SELECT CONVERT(NVARCHAR, CAST('20201010' AS DATE), 103) 


---Converting a Varchar to a Datetime

SELECT convert(DATE, '25 Oct 21', 6)
----
select convert(varchar, getdate(), 6)

https://www.mssqltips.com/sqlservertip/1145/date-and-time-conversions-using-sql-server/ 


---ROUND
-- ÃœÃ§Ã¼ncÃ¼ parametre sonucun aÅŸaÄŸÄ±ya mÄ± yukarÄ±ya mÄ± yuvarlanacaÄŸÄ±nÄ± belirlemek iÃ§in kullanÄ±lmaktadÄ±r.
-- Default olarak 0 (yani yukarÄ±ya yuvarlama) atanmÄ±ÅŸtÄ±r. AÅŸaÄŸÄ± deÄŸere yuvarlamak iÃ§in 1 yazÄ±lmalÄ±dÄ±r.
SELECT ROUND (432.368, 2, 0)
SELECT ROUND (432.368, 2, 1)
SELECT ROUND (432.368, 2)

SELECT ROUND(123.4567, 2) -- veri tipine gÃ¶re dÃ¶nÃ¼ÅŸÃ¼m yapar. yuvarlar ancak sondaki iki ondalÄ±klÄ± kÄ±smÄ± kaybetmiyor.

SELECT ROUND(123.4567, 2, 0) -- defaultu sÄ±fÄ±r. 

SELECT ROUND(123.4567, 2, 1) -- 0 haricinde bir sayÄ± yuvarlama yapmadan son ikisini sÄ±fÄ±rlar. 

SELECT CONVERT(INT, 123.9999)
SELECT CONVERT(DECIMAL(18,2), 123.4567)

DECLARE @value float(10)
SET @value = .1234567890
SELECT ROUND(@value, 1)  -- 0.1
SELECT ROUND(@value, 2)  -- 0.12
SELECT ROUND(@value, 3)  -- 0.123
SELECT ROUND(@value, 4)  -- 0.1235
SELECT ROUND(@value, 5)  -- 0.12346
SELECT ROUND(@value, 6)  -- 0.123457
SELECT ROUND(@value, 7)  -- 0.1234568
SELECT ROUND(@value, 8)  -- 0.12345679
SELECT ROUND(@value, 9)  -- 0.123456791
SELECT ROUND(@value, 10) -- 0.123456791

---ISNUMERIC
---The ISNUMERIC() function checks whether a value can be converted
---to a numeric data type
-- Bir ifadenin geÃ§erli bir sayÄ±sal tÃ¼r olup olmadÄ±ÄŸÄ±nÄ± belirler.

-- Girdi ifadesi geÃ§erli bir sayÄ±sal veri tÃ¼rÃ¼ olarak deÄŸerlendirildiÄŸinde 1 dÃ¶ndÃ¼rÃ¼r ; 
--aksi halde 0 dÃ¶ndÃ¼rÃ¼r . GeÃ§erli sayÄ±sal veri tÃ¼rleri ÅŸunlardÄ±r: bigint, int, smallint, tinyint, bit, decimal, numeric, 
-- float, real, money, smallmoney .


SELECT ISNUMERIC(11111)
SELECT ISNUMERIC('11111')
SELECT ISNUMERIC('clarusway')


---COALESCE
---EÄžER Ä°LK Ä°FADE NULL Ä°SE BÄ°R SONRAKÄ° DEÄžERÄ° GETÄ°RÄ°R, O DA NULL Ä°SE BÄ°R SONRAKÄ°NÄ°

SELECT COALESCE(NULL, 'Hi', 'Hello', NULL) result;

SELECT COALESCE(NULL, NULL ,'Hi', 'Hello', NULL) result;

SELECT COALESCE(NULL, NULL ,'Hi', 'Hello', 100, NULL) result;
---This function doesn't limit the number of arguments, but they must all be of the same data type.

SELECT COALESCE(NULL, NULL) result;

-- ArgÃ¼manlarÄ± sÄ±rayla deÄŸerlendirir ve baÅŸlangÄ±Ã§ta NULL olarak deÄŸerlendirilmeyen ilk ifadenin geÃ§erli deÄŸerini dÃ¶ndÃ¼rÃ¼r.
â€‹
SELECT COALESCE (NULL, NULL ,'Hi', 'Hello', NULL) result;  -- Ilk non null degeri getirir

---ISNULL()
---replaces NULL with a specified value
-- ISNULL(check expression, replacement value)â€‹: Belirtilen DEGERI,  NULLdeÄŸeriyle deÄŸiÅŸtirir.

-- BoÅŸ deÄŸerleri belirli bir deÄŸerle doldurmak istiyorsanÄ±z ISNULL()iÅŸlevi kullanabilirsiniz.

SELECT ISNULL(NULL, 'Not null yet.') AS col;

SELECT ISNULL(1, 2) AS col;  -- Tablo deÄŸerleri Ã¼zerinde Ã§alÄ±ÅŸÄ±yorsanÄ±z, yukarÄ±daki sorguda "1" ve "2" yerine sÃ¼tun adlarÄ± yazabilirsiniz.

SELECT ISNULL(NULL, 1)

SELECT ISNULL(phone, 'no phone')
FROM sale.customer

---difference between coalesce and isnull

SELECT ISNULL(phone, 0)
FROM sale.customer

SELECT COALESCE(phone, 0) --ERROR string bir sÃ¼tun olduÄŸu iÃ§in error verdi. 
FROM sale.customer


---NULLIF
---returns NULL if two arguments are equal. Otherwise, it returns the first expression.

SELECT NULLIF(10,10)

SELECT NULLIF('Hello', 'Hi') result;

SELECT NULLIF(2, '2')


-------------------------------------------------------------------------
--QUERY TIME FOR YOU---------------
-------------------------------------------------------------------------

-- How many customers have yahoo mail?
-- (yahoo mailine sahip kaÃ§ mÃ¼ÅŸteri vardÄ±r?)

SELECT count(customer_id)
FROM sale.customer
WHERE PATINDEX('%yahoo%', email) > 0;


-------------------------------------------------------
---Write a query that returns the name of the streets, where the third character of the streets is numeric.
---(street sÃ¼tununda soldan Ã¼Ã§Ã¼ncÃ¼ karakterin rakam olduÄŸu kayÄ±tlarÄ± getiriniz)

SELECT street, LEFT(street, 3)
FROM sale.customer
WHERE ISNUMERIC(LEFT(street, 3)) = 1; -- ilk Ã¼Ã§Ã¼ rakam ise dÃ¶ndÃ¼r. 
--------------------------------------------------------
SELECT street, SUBSTRING(street, 3, 1) third_char
FROM sale.customer
WHERE ISNUMERIC(SUBSTRING(street, 3, 1)) = 1; -- soldan Ã¼Ã§Ã¼ncÃ¼ rakamÄ± dÃ¶ndÃ¼r. 
-------------------------------------------------------
SELECT street, SUBSTRING(street, 3, 1) third_char
FROM sale.customer
WHERE street like '__[0-9]%'
-------------------------------------------------------
--Add a new column to the customers table that contains the customers' contact information. 
--If the phone is not null, the phone information will be printed, if not, the email information will be printed.

SELECT customer_id, first_name, last_name, ISNULL(phone, email) as contact_info, COALESCE(phone, email, street+city+state) --COALESCE phone null ise email her ikiside null ise street+city+state gir)
FROM sale.customer


--her mÃ¼ÅŸteriye ulaÅŸabileceÄŸim telefon veya email bilgisini istiyorum.
--MÃ¼ÅŸterinin telefon bilgisi varsa email bilgisine gerek yok.
--telefon bilgisi yoksa email adresi iletiÅŸim bilgisi olarak gelsin.
--beklenen sÃ¼tunlar: customer_id, first_name, last_name, contact





-------------------------------------------------------
--Split the mail addresses into two parts from â€˜@â€™, and place them in separate columns.

--@ iÅŸareti ile mail sÃ¼tununu ikiye ayÄ±rÄ±n. Ã–rneÄŸin
--ronna.butler@gmail.com	/ ronna.butler	/ gmail.com



SELECT LEFT(email, CHARINDEX('@', email) - 1) AS username,
       RIGHT(email, LEN(email) - CHARINDEX('@', email)) AS domain
FROM sale.customer;
-------------------------------
SELECT email, 
       SUBSTRING(email,1,(CHARINDEX('@', email)-1)) as email_name,
       SUBSTRING(email,(CHARINDEX('@', email)+1), (LEN(email) - (CHARINDEX('@', email)))) as email_provider 
FROM sale.customer;